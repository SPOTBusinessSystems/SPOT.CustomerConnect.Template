var CustomerConnect={Config:{AccountKey:null,SessionId:null,CustomerName:null,URL:null,Settings:null},Request:{CreateRequest:function(e,t){var n=$.Deferred(),s='{"RequestType":"'+e+'","AccountKey":"'+CustomerConnect.Config.AccountKey+'","SessionID":"'+CustomerConnect.Config.SessionId+'","Body":"'+CustomerConnect.Util.base64._encode(JSON.stringify(t))+'","UserAgent":"'+navigator.userAgent.toString()+'"}';if("string"!=typeof(new XMLHttpRequest).responseType&&window.XDomainRequest){var r=new XDomainRequest;r.open("post",CustomerConnect.Config.URL),r.onload=function(){var t=jQuery.parseJSON(r.responseText);"Login"!=e||t.Failed||(CustomerConnect.Config.SessionId=t.ReturnObject.SessionID,CustomerConnect.Config.CustomerName=t.ReturnObject.CustomerName),"Logoff"!=e||t.Failed||(CustomerConnect.Config.SessionId=null,CustomerConnect.Config.CustomerName=null),t.Failed?n.reject(t):n.resolve(t)},r.onprogress=function(){},r.ontimeout=function(){},r.onerror=function(){n.reject(data)},setTimeout(function(){r.send(s)})}else $.ajax({url:CustomerConnect.Config.URL,data:s,type:"POST",async:!0,dataType:"json",success:function(t){"Login"!=e||t.Failed||(CustomerConnect.Config.SessionId=t.ReturnObject.SessionID,CustomerConnect.Config.CustomerName=t.ReturnObject.CustomerName),"Logoff"!=e||t.Failed||(CustomerConnect.Config.SessionId=null,CustomerConnect.Config.CustomerName=null),t.Failed?n.reject(t):n.resolve(t)},error:function(e){e.Failed=!0,e.Message="HTTP Request failed.",n.reject(e)}});return n.promise()}},AR:{ARStatement:function(e){this.statementId=e},ARPayment:function(e,t,n,s,r){this.cardOnFileId=e,this.cardNo=t,this.cardExp=n,this.addCardToAccount=s,this.amount=r},GetARBalance:function(){return new CustomerConnect.Request.CreateRequest("ARBalance",null)},GetARCurrentActivity:function(){return new CustomerConnect.Request.CreateRequest("ARCurrentActivity",null)},GetPaymentDetails:function(){return new CustomerConnect.Request.CreateRequest("ARPaymentsDetail",null)},GetStatementDetails:function(e){return new CustomerConnect.Request.CreateRequest("ARStatementDetail",new this.ARStatement(e))},GetStatementsList:function(){return new CustomerConnect.Request.CreateRequest("ARStatementsList",null)},SavePayment:function(e,t,n,s,r){return new CustomerConnect.Request.CreateRequest("SavePayment",new this.ARPayment(e,t,n,s,r))}},Customer:{AddressObject:function(e,t,n,s,r){this.address1=e,this.address2=t,this.city=n,this.state=s,this.zip=r},Award:function(e){this.id=e},CustomerInfo:function(e,t,n,s,r,i,o,u,a,c,C,h,m,R,l,f,d,q,g,A,w,S,p,v,y,b,I,P,N){this.clientAccountID=e,this.firstName=t,this.lastName=n,this.emailAddress=s,this.serviceType=r,this.password=i,this.accountNodeID=o,this.title=u,this.statementDestination=a,this.comments=c,this.referralSource=C,this.birthDate=h,this.routeID=m,this.clientInfo=R,this.primaryAddress={Address1:l,Address2:f,City:d,State:q,Zip:g},this.deliveryAddress={Address1:A,Address2:w,City:S,State:p,Zip:v},this.billingAddress={Address1:y,Address2:b,City:I,State:P,Zip:N}},GiftCardNumber:function(e){this.number=e},Notification:function(e,t,n){this.notificationTypeName=e,this.notificationMethodName=t,this.notificationValue=n},ConvertToDelivery:function(e){return new CustomerConnect.Request.CreateRequest("ConvertToDelivery",e)},GetCustomer:function(){return new CustomerConnect.Request.CreateRequest("CustomerDetail",null)},IssueAward:function(e){return new CustomerConnect.Request.CreateRequest("IssueAward",new this.Award(e))},NotifyPickup:function(e,t){return new CustomerConnect.Request.CreateRequest("NotifyPickup",new this.PickupNotification(e,t))},PickupNotification:function(e,t){this.storeId=SPAccountNodeID,this.timeRequested=TimeRequested},RedeemGiftCard:function(e){return new CustomerConnect.Request.CreateRequest("GiftCardRedeem",new this.GiftCardNumber(e))},RetrieveGiftCardBalance:function(e){return new CustomerConnect.Request.CreateRequest("GiftCardBalance",new this.GiftCardNumber(e))},RetrieveGiftCards:function(){return new CustomerConnect.Request.CreateRequest("RetrieveGiftCards",null)},SaveCustomer:function(e){return""===e.clientAccountID?new CustomerConnect.Request.CreateRequest("Signup",e):new CustomerConnect.Request.CreateRequest("SaveCustomer",e)},SaveNotification:function(e){return new CustomerConnect.Request.CreateRequest("Unsubscribe",e)},SaveNotificationNoUser:function(e){return new CustomerConnect.Request.CreateRequest("UnsubscribeNoUser",e)},SaveNotificationAll:function(e){return new CustomerConnect.Request.CreateRequest("UnsubscribeAll",e)},SaveNotificationAllNoUser:function(e){return new CustomerConnect.Request.CreateRequest("UnsubscribeAllNoUser",e)},SendEmail:function(e){return new CustomerConnect.Request.CreateRequest("SendEmail",e)}},Invoice:{Invoice:function(e){this.invoiceId=e},InvoicesList:function(e,t,n){this.filterTypeId=e,this.startDate=t,this.endDate=n},InvoicesListGarment:function(e,t){this.garmentDesc=e,this.descriptor=t},GetInvoiceDetails:function(e){return new CustomerConnect.Request.CreateRequest("InvoiceDetail",new this.Invoice(e))},GetInvoiceList:function(e,t,n){return new CustomerConnect.Request.CreateRequest("InvoicesList",new this.InvoicesList(e,t,n))},GetInvoiceListGarment:function(e,t){return new CustomerConnect.Request.CreateRequest("InvoicesByGarment",new this.InvoicesListGarment(e,t))}},Route:{CancellationRequest:function(e,t,n,s){this.fromDate=e,this.toDate=t,this.comments=n,this.instructionsRequest=s},PickupRequest:function(e,t,n,s,r,i,o){this.accountTransactionNumber=e,this.comments=n,this.instructionsRequest=s,this.deliveryType=r,this.pickupDate=t,this.visitType=i,this.deliveryDate=o},GetRouteDeliveryZones:function(){return new CustomerConnect.Request.CreateRequest("GetDeliveryZones",null)},PendingCancellations:function(){return new CustomerConnect.Request.CreateRequest("PendingCancellations",null)},PendingPickups:function(){return new CustomerConnect.Request.CreateRequest("PendingPickups",null)},SaveCancellationRequest:function(e){return new CustomerConnect.Request.CreateRequest("CancellationRequest",e)},SavePickupRequest:function(e){return new CustomerConnect.Request.CreateRequest("PickupRequest",e)}},Settings:{JSONBlob:function(e,t,n){this.instanceId=e,this.name=t,this.json=n},GetNotifications:function(){return new CustomerConnect.Request.CreateRequest("GetNotifications",null)},GetPreferences:function(){return new CustomerConnect.Request.CreateRequest("GetPreferences",null)},GetSettings:function(){return new CustomerConnect.Request.CreateRequest("GetSettings",null)},GetStates:function(){return new CustomerConnect.Request.CreateRequest("GetStates",null)},StoreJSON:function(e,t){return new CustomerConnect.Request.CreateRequest("StoreJSON",{name:e,json:t})},RetrieveJSON:function(e){return new CustomerConnect.Request.CreateRequest("RetrieveJSON",{name:e})},ValidateCaptcha:function(e){return new CustomerConnect.Request.CreateRequest("ValidateCaptcha",{response:e})}},Store:{GetStoreList:function(){return new CustomerConnect.Request.CreateRequest("StoreList",null)}},User:{MessageToManager:function(e,t,n){this.subject=e,this.message=t,this.invoiceid=n},ChangePassword:function(e){return new CustomerConnect.Request.CreateRequest("ChangePassword",e)},SendMessage:function(e,t,n){return new CustomerConnect.Request.CreateRequest("MessageToManagerNoUser",new this.MessageToManager(e,t,null))},SendMessageUser:function(e,t,n){return new CustomerConnect.Request.CreateRequest("MessageToManagerUser",new this.MessageToManager(e,t,n))},LoginObject:function(e,t){this.user=e,this.password=t},Login:function(e,t){return new CustomerConnect.Request.CreateRequest("Login",new this.LoginObject(e,t))},Logout:function(){return new CustomerConnect.Request.CreateRequest("Logoff",null)},PasswordReminder:function(e){return new CustomerConnect.Request.CreateRequest("RememberPasswordRequest",e)},FinishPasswordReminder:function(e){return new CustomerConnect.Request.CreateRequest("RememberPasswordFinish",e)},InsertEventRequest:function(e,t,n,s,r){this.productName=e,this.customerID=t,this.eventStartDateTime=n,this.eventSource=s,this.eventEndDateTime=r},InsertEvent:function(e){return new CustomerConnect.Request.CreateRequest("InsertEvent",e)},UpdateEventRequest:function(e,t,n){this.instanceID=e,this.customerID=t,this.eventEndDateTime=n},UpdateEvent:function(e){return new CustomerConnect.Request.CreateRequest("UpdateEvent",e)}},Util:{GetIP:function(){return new CustomerConnect.Request.CreateRequest("GetIP",null)},base64:{_PADCHAR:"=",_ALPHA:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",_VERSION:"1.0",_getbyte64:function(e,t){var n=this._ALPHA.indexOf(e.charAt(t));if(-1===n)throw"Cannot decode base64";return n},_decode:function(e){var t,n,s=0,r=e.length,i=[];if(e=String(e),0===r)return e;if(r%4!==0)throw"Cannot decode base64";for(e.charAt(r-1)===this._PADCHAR&&(s=1,e.charAt(r-2)===this._PADCHAR&&(s=2),r-=4),t=0;r>t;t+=4)n=this._getbyte64(e,t)<<18|this._getbyte64(e,t+1)<<12|this._getbyte64(e,t+2)<<6|this._getbyte64(e,t+3),i.push(String.fromCharCode(n>>16,n>>8&255,255&n));switch(s){case 1:n=this._getbyte64(e,t)<<18|this._getbyte64(e,t+1)<<12|this._getbyte64(e,t+2)<<6,i.push(String.fromCharCode(n>>16,n>>8&255));break;case 2:n=this._getbyte64(e,t)<<18|this._getbyte64(e,t+1)<<12,i.push(String.fromCharCode(n>>16))}return i.join("")},_getbyte:function(e,t){var n=e.charCodeAt(t);if(n>255)throw"INVALID_CHARACTER_ERR: DOM Exception 5";return n},_encode:function(e){if(1!==arguments.length)throw"SyntaxError: exactly one argument required";e=String(e);var t,n,s=[],r=e.length-e.length%3;if(0===e.length)return e;for(t=0;r>t;t+=3)n=this._getbyte(e,t)<<16|this._getbyte(e,t+1)<<8|this._getbyte(e,t+2),s.push(this._ALPHA.charAt(n>>18)),s.push(this._ALPHA.charAt(n>>12&63)),s.push(this._ALPHA.charAt(n>>6&63)),s.push(this._ALPHA.charAt(63&n));switch(e.length-r){case 1:n=this._getbyte(e,t)<<16,s.push(this._ALPHA.charAt(n>>18)+this._ALPHA.charAt(n>>12&63)+this._PADCHAR+this._PADCHAR);break;case 2:n=this._getbyte(e,t)<<16|this._getbyte(e,t+1)<<8,s.push(this._ALPHA.charAt(n>>18)+this._ALPHA.charAt(n>>12&63)+this._ALPHA.charAt(n>>6&63)+this._PADCHAR)}return s.join("")}},Validate:{CCExpiration:function(e){return/^[0-9]{2}[//][0-9]{2}$/.test(e)&&(new Date).getFullYear()<Number(e.split("/")[1])+2e3?!0:!1},CCNumber:function(e){for(var t,n=0,s=1,r=e.length;r--;)t=parseInt(e.charAt(r),10)*s,n+=t-9*(t>9),s^=3;return n%10===0&&n>0},CCType:function(e){return"undefined"==typeof CustomerConnect.Config.Settings.CCTypesSupported?!1:-1==CustomerConnect.Config.Settings.CCTypesSupported.search(CustomerConnect.Util.Validate.GetCCType(e))?!1:CustomerConnect.Util.Validate.CCNumber(e)},EmailAddress:function(e){return/^[A-Za-z0-9.]+@[A-Za-z0-9]+\.[A-Za-z]{2,4}/.test(e)},GetCCType:function(e){var t=(e+"").replace(/\s/g,"");return/^(34|37)/.test(t)&&15==t.length?"AMEX":/^(51|52|53|54|55)/.test(t)&&16==t.length?"MC":!/^(4)/.test(t)||13!=t.length&&16!=t.length?/^(300|301|302|303|304|305|36|38)/.test(t)&&14==t.length?"DNRS":/^(6011)/.test(t)&&16==t.length?"DISC":/^(3)/.test(t)&&16==t.length?"JCB":/^(2131|1800)/.test(t)&&15==t.length?"JCB":/^(300|301|302|303|304|305|36|38)/.test(t)&&14==t.length?"CART":!/^(6334|6767)/.test(t)||16!=t.length&&18!=t.length&&19!=t.length?!/^(4903|4905|4911|4936|564182|633110|633|6759)/.test(t)||16!=t.length&&18!=t.length&&19!=t.length?!/^(5020|6)/.test(t)||16!=t.length&&18!=t.length?"UNKN":"MAES":"SWTC":"SOLO":"VISA"},Password:function(e){return/^.{6,30}$/.test(e)&&/[A-Z]/.test(e)&&/[0-9]/.test(e)&&/[a-z]/.test(e)?!0:!1},Phone10:function(e){var t=(e+"").replace(/[^\d]/g,"");return/^[\d]{10}$/.test(t)}}}};